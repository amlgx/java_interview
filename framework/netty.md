### TCP粘包/拆包

服务端的TCP滑动窗口大于2/小于1个数据包，就会粘/拆包。原因包括：写入字节数超过了发送缓冲区大小，MSS大小的TCP分段，以太网帧的payload大于MTU进行IP分片。

解决方案包括：消息定长(FixedLengthFrameDecoder)，包尾用换行符/特殊分割符分割
(LineBasedFrameDecoder/DelimiterBasedFrameDecoder),消息头中加入总长度信息。

#### Netty的线程模型

单线程模型由一个线程同时处理连接和消息。多线程模型由专用的Acceptor线程监听连接，将建立的连接注册到后端IO线程池的线程来处理消息。主从多线程模型由一个Acceptor线程池来处理更重的任务(可能包含接入验证等)，后端仍是线程池处理。

netty根据不同的配置可以同时支持这3种模型。

### netty高性能的原因

- 异步非阻塞通信
- 高效的Reactor通信模型
- 无锁化的串行设计：IO线程内无锁而避免多线程竞争和切换。
- 高效的并发编程
- 高性能的序列化框架
- 零拷贝：直接内存的socket读写不需要从虚拟机到操作系统的拷贝，缓冲区类的组合不需要拷贝，文件传输不需要拷贝。
- 内存池
- 灵活的TCP参数配置